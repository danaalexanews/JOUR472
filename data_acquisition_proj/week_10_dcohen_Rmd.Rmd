---
title: "Data_acqusition_project"
author: "Dana Cohen"
date: "11/4/2019"
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE, paged.print=TRUE)
```

## Objective

The purpose of this lab is to continue learning a journalistic approach to data analysis in R. 

We will continue to do things learned in previous labs:

* Writing R code for data analysis and exploration in the R Studio environment, using R projects (.Rproj) and R markdown files (.Rmd).  
* Loading, cleaning, making sense of and analyzing data using the Tidyverse framework of packages by selecting certain columns, sorting and filtering
* Create new columns in our data set based on information in other columns.   
* Summarizing data by grouping and calculating min, max, median and mean values.    
* Store changes on GitHub.

Today, we'll also:

* Learn how to join together two related data sets on a common field to perform a new kind of analysis, and discuss common problems that arise when doing joins.  
* Do some additional data cleaning, including fixing dates so we can work with them. 

## How this works, tasks, turning it in, getting help

This document is mostly set up for you to follow along and run code that I have written, and listen to me explain it.  

At several points throughout this document, you will see the word **Task**.  

That indicates I'm expecting you to modify the file I've given you, usually by creating a codeblock and writing some custom code. 

When you are finished, you should save your R markdown file and Knit it as an HTML file. 

You should upload it to GitHub, using GitHub desktop, a process that will be explained. 

And the links to your project is what you'll post on ELMS. 

Need help?  You are welcome to do the following things:

* Use Google or search Stack Overflow. Try searching for your error message or translating your problem into basic terms.
* Check out the excellent [R for Data Science](https://r4ds.had.co.nz/index.html)
* Take a look at the [Cheatsheets](https://www.rstudio.com/resources/cheatsheets/) and [Tidyverse documentation](https://www.tidyverse.org/).
  * [RStudio cheatsheet](https://www.rstudio.com/resources/cheatsheets/#ide)
  * [Readr and Tidyr cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf) and [Readr documentation](https://readr.tidyverse.org/) and [Tidyr documentation](https://tidyr.tidyverse.org/reference/index.html).
  * [Dplyr cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf) and [Dplyr documentation](https://dplyr.tidyverse.org/)
  * [Lubridate cheatsheet](https://rawgit.com/rstudio/cheatsheets/master/lubridate.pdf) and [Lubridate documentation](https://lubridate.tidyverse.org/).
  * [GitHub desktop help](https://help.github.com/en/desktop/getting-started-with-github-desktop)
* If you're really stuck, message me on ELMS. 

## Setup

Take the following steps to set up your document:

1. Download the ZIP file and open the folder on your desktop. It should contain this document and the data you'll need.
2. Create a new folder in your git repo and move it in there. Unzip the folder.
3. Open this file in RStudio.
4. Rename this file "lab_05_FIRSTNAME_LASTNAME.Rmd".
5. Create a new R project inside of this folder, which will set the working directory in this folder.   

## Load Packages

We're loading three packages today: the Tidyverse, Janitor and a new one, [Lubridate](https://lubridate.tidyverse.org/), which is in the Tidyverse family, but it doesn't load when you load library(tidyverse). So you need to load it separately. 

**Task**: In the code block below, load the Tidyverse family of packages, the Janitor package, and the Lubridate package. If you've never loaded lubridate before, you'll need to install it first. You should be good at installing and loading packages at this point. If you have problems, Google it or look at previous labs. 

```{r}
chooseCRANmirror(graphics=FALSE, ind = 1)
knitr::opts_chunk$set(echo = TRUE)
install.packages("lubridate")
install.packages("tidyverse")
install.packages("janitor")
# Load Tidyverse and Janitor
library(janitor)
library(tidyverse)
library(lubridate)
```

## Load Data

For this exercise, we will be working with subsets of the DEA's ARCOS database, which documented shipments of 76 billion opioid pills between 2006 and 2012, during the peak of the opioid epidemic. First, we will be working with a subset of shipments to Mingo County, West Virginia, which was flooded with hydrocodone and oxycodone during that period.  We will be loading additional data below. 

The data was obtained after a lengthy legal battle by the Washington Post and the Charleston Gazette-Mail, and released by the Washington Post in raw and aggregated form. [Washington Post "Digging into the DEA's pain pill database" page](https://www.washingtonpost.com/graphics/2019/investigations/dea-pain-pill-database/).

A data dictionary is available here: [ARCOS Registrant Handbook](https://www.deadiversion.usdoj.gov/arcos/handbook/full.pdf).

```{r}

# Load data and store it as an object called baltimore

baltimore <- read_tsv("arcos-md-baltimore-city-24520-itemized.tsv")

# Load data and store it as an object called howard

howard<- read_tsv("arcos-md-howard-24027-itemized.tsv)

```

## Examine the Data

**Task**: Use glimpse() and View() to get a sense of the data.  

```{r}
glimpse(baltimore)
```

```{r}
view(baltimore)
```

```{r}
glimpse(howard)
```

```{r}
view(howard)
```


#KEYS
census_api_key("6807e6be8b6aeed023ebd2791acda76a66b32754")
arcos_key <- "aoQ1LGl"
#CENSUS DATA VARIABLES 
acs_variables <- load_variables(2012, "acs5", cache = TRUE)
#GEODATA OF COUNTIES 
county_geodata_shifted <- get_acs(geography = "county",
              variables = "B01001_001", geometry = TRUE, shift_geo = TRUE)
#GEODATA OF STATES 
state_geodata_shifted <- get_acs(geography = "state",
              variables = "B01001_001", geometry = TRUE, shift_geo = TRUE)
              
```{p}
#QUESTION 1 - Is Baltimore county -  where the median income is lower than Howard County - a place where more deaths have occurred?
#Using median income for specific counties
county_medianincome <- get_acs(geography = "county",
             variables = "B06011_001", geometry = FALSE)
```


```{p}
#QUESTION 2 - What percentage of African Americans were effected/killed by opiods in baltimore city?
county_african_american_population <- get_acs(geography = "county",
             variables = "C02003_003", geometry = FALSE)
```

```{p}
#QUESTION 3 - What percentage of caucasions were effected by opiods in baltimore city?
county_caucasian_population <- get_acs(geography = "county",
             variables = "C02003_003", geometry = FALSE)
```

```{p}
#QUESTION 4 - What percentage of African Americans were effected by opiods in howard county?
county_african_american_population <- get_acs(geography = "county",
             variables = "C02003_003", geometry = FALSE)
```


```{p}
#QUESTION 5 - What percentage of caucasians were effected by opiods in howard county?
```county_caucasian_population <- get_acs(geography = "county",
             variables = "C02003_003", geometry = FALSE)
```

```{p}
#QUESTION 6 -  which subset of Baltimore received the most pills per person between 2006 and 2012? 
total_maryland_county_pills_2012 <- maryland_counties_pills_per_year %>%
  summarise(total_pills = sum(DOSAGE_UNIT))
```

```{p}
#QUESTION 7 - which subset of Howard County received the most pills per person between 2006 and 2012? 
```

```{p}
#QUESTION 8 - Looking at the state of Maryland, are counties with a higher poverty rate more likely to have a higher death count?
county_povertyrate <- get_acs(geography = "county",
             variables = "B06012_002", geometry = FALSE, summary_var = "B01001_001") %>%
 mutate(poverty_rate=estimate/summary_est)
```


```{p}
#Question 9 - Looking at the state of Maryland, are counties with lower housing prices places where death rates were higher?
county_median_household_prices <- get_acs(geography = "county",
             variables = "B25105_001", geometry = FALSE)
```

```{p}
#Question 10 - Looking at the state of Maryland, are counties with lower education levels places where death rates were higher?
county_education_business_science_jobs <- get_acs(geography = "county",
             variables = "B24011_010", geometry = FALSE)
```































